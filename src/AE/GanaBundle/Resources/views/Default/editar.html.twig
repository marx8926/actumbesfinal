{% extends "::base.html.twig" %}

{% block titulo %} Editar - {% endblock %}

{% block stylesheets %}
        <link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.css" media="screen" rel="stylesheet" type="text/css">
        <link href="http://d19k46zntalu3t.cloudfront.net/css/style.css" media="screen" rel="stylesheet" type="text/css">
        <link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap-responsive.css" media="screen" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.datepicker.css">
        <link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/smooth/jquery-ui-1.8.16.custom.css" >
 {% endblock %}
           
{% block content %}
    <div class="span9" id="registro_form">
    <h1>Editar Nuevo</h1>
    <br>
        <form class="form-horizontal" action="{{path('ae_gana_persona')}}" method="POST" id="form_persona" name="form_persona">
           
            <input type="hidden" name="id_persona" id="id_persona" value="{{persona.id}}">
            <fieldset>
                <legend>Datos Personales</legend>        
                <div class="span9">
                    <div class="control-group" >
                        <label class="control-label"> Nombres (*) </label>
                        <div class="controls">
                            <input type="text" id="inputNombres" name="inputNombres"  placeholder="Nombres" value="{{persona.nombre}}" class="input-xxlarge" required="true" pattern="|^[a-zA-Z ñÑáéíóúüç]+$|" required />
                        </div>
                    </div>
        
                    <div class="control-group" >
                        <label class="control-label">Apellidos (*)</label>
                        <div class="controls">
                            <input type="text" id="inputApellidos" name="inputApellidos" placeholder="Apellidos" value="{{persona.apellidos}}" class="input-xxlarge" pattern="|^[a-zA-Z ñÑáéíóúüç]+$|" required />
                        </div>
                    </div>
                </div>
                
                  
                <div class="span9">
                    <div class="span3">
                        <div class="control-group">
                            <label class="control-label" >Fecha nacimiento (*)</label>
                            <div class="controls">
                                <input type= "text" class="datepick input-medium" id="inputFechaNacimiento" name="inputFechaNacimiento" value="{{persona.fechaNacimiento|date("d/m/Y")}}"/>
                                <p class="help-block">Día/Mes/Año</p>  
                            </div>
                        </div>
                    </div>
                    
                    <div class="span3">
                        
                        <div class="control-group">
                            <label class="control-label" >Edad (*)</label>
                            <div class="controls">
                                <input type="number" min="0"  max="120" class="input-small" placeholder="Edad" id="inputEdad" name="inputEdad" required value="{{persona.edad}}"/>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                <div class="span9">
                    
                    <div class="span3" >
                        
                         
                        <div class="control-group ">
                            <label class="control-label" for="select02"> Estado Civil (*)</label>
                            <div class="controls">
                                <select id="select_Civil" name="select_Civil" required class="input-medium">
                                    <option value="0">Solter@</option>
                                    <option value="1">Casad@</option>  
                                    <option value="2">Conviviente</option>
                                    <option value="3">Viud@</option>
                                    <option value="4">Divorciado</option>
                                    <option value="5">Madre Soltera</option>

                                </select>
                            </div>
                        </div>
                
                    </div>
                    <div class="span3">
                        <div class="control-group">
                            <label class= "control-label" for="select01"> Sexo (*) </label>
                            <div  class="controls">
                                <select name="select_Sexo" id="select_Sexo" required class="input-medium">
                                    <option value="1">Masculino</option>
                                    <option value="2">Femenino</option>
                                </select>
                            </div>
                        </div>
                     </div>
                    
                    
                </div>
               
                
               <div class="span9">
                   <div class="span3">
                        <div class="control-group">
                            <label class="control-label" >DNI (*)</label>
                            <div class="controls">
                                <input type="text" class="input-medium" placeholder="DNI" id="inputDni" name="inputDni" pattern="[0-9]{8}" value="{{persona.dni}}" required />
                                <p class="help-block">8 digitos</p>
                            </div>
                        </div>
                   </div>
                   <div class="span3">
                       <div class="control-group">
                        <label class="control-label" >Ocupación (*)</label>
                        <div class="controls">
                            <input type="text" class="input-medium" placeholder="Ocupación" id="inputOcupacion" name="inputOcupacion" value="{{persona.ocupacion}}" required />
                        </div>
                       </div>
                       
                   </div>
                </div>
               
              
        
                <div class="span9">
                    
                    <div class="span3">
                        <div class="control-group">
                            <label class="control-label" >Teléfono</label>
                            <div class="controls">
                                <input type="text" class="input-medium" placeholder="Telefono" id="inputTelefono" name="inputTelefono" value="{{persona.telefono}}" pattern="[0-9]{9}"/>
                                <p class="help-block">0codigonúmero</p>
                            </div>
                        </div>
                        
                    </div>
                    
                    <div class="span3">
                        <div class="control-group">
                            <label class="control-label" >Celular</label>
                            <div class="controls">
                                <input type="text" class="input-medium" placeholder="Celular" id="inputCelular" name="inputCelular" value="{{persona.celular}}" />
                                <p class="help-block">9 digitos</p>
                            </div>
                        </div>
                    </div>
                </div>
       
                <div class="span9">
                    
                    <div class="span3">
                        <div class="control-group">     
                            <label class="control-label" >Email</label>      
                            <div class="controls">
                                <input type="text" id="inputEmail" name="inputEmail" placeholder="Email" value="{{persona.email}}" class="input-medium" pattern="[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9.-]+" />      
                            </div>      
                        </div>
                    </div>
                </div>

            </fieldset>
            
            <fieldset>
                <legend>Ubicación</legend>
        
                <div class="control-group">
                    <label class="control-label">Dirección (*)</label>
                    <div class="controls">
                        <input type="text" class="input-xxlarge" id="inputDireccion" name="inputDireccion" value="{{persona.idUbicacion.direccion}}" required />
                    </div>
                </div>
        
                <div class="control-group">
                    <label class="control-label">Referencia</label>
                    <div class="controls" >
                        <input type="text" class="input-xxlarge" id="inputReferencia" value="{{persona.idUbicacion.referencia}}" name="inputReferencia" />
                    </div>
                </div>
                
                <div class="span12">
                    <div class="span3">
                        <div class="control-group">
                            <label class="control-label" >Departamento (*)</label>
                            <div class="controls">
                                <select name="departamento_lista" id="departamento_lista" required  class="input-medium">
                    
                                </select>
                            </div>
                        </div>  
                    </div>
        
                    <div class="span3">
                        <div class="control-group">
                            <label class="control-label" >Provincia (*)</label>
                            <div class="controls">
                                <select name="provincia_lista" id="provincia_lista" required class="input-medium">
                   
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="span3">
        
                        <div class="control-group">
                            <label class="control-label">Distrito (*)</label>
                            <div class="controls">
                                <select name="distrito_lista" id="distrito_lista" required class="input-medium">
                    
                                </select>
                            </div>        
                        </div>
                    </div>
                </div>
        
    </fieldset>
    <fieldset>
        <legend>Iglesia</legend>
        
        <div class="span9">
            
            <div class="span3">
                <div class="control-group">
                    <label class="control-label" >Red</label>
                    <div class="controls">
                        <select id="red_lista" name="red_lista" class="input-medium" >
                   
                        </select>
                    </div>
                </div>
            </div>
           <!--
            <div class="span3">
               <div class="control-group">
                <label class="control-label">Asiste a Célula</label>
                <div class="controls">
                    <label class="radio">
                        <input type="radio" id="celula" name="celula" value="si"> Si
                    </label>
                    <label class="radio">
                        <input type="radio" id="celula" name="celula" value="no"> No
                    </label>
                </div>
               </div> 
            </div>
            
            -->
        </div>
        
        
        <div class="span9">
            <div class="span3">
                <div class="control-group">
                    <label class="control-label">Fecha Conversión (*)</label>
                    <div class="controls">
                        <input type= "text" class="datepick input-medium" id="inputFechaConversion"
                        name="inputFechaConversion" required value="{{detalle.convertido |date("d/m/Y") }}"/>
                        <p class="help-block">Día/Mes/Año</p>  
                    </div>
                </div>
            </div>
            
            <div class="span3">
                <div class="control-group">
                    <label class="control-label">Lugar (*)</label>
                    <div class="controls">
                        <select id="lugar" name="lugar" required class="input-medium">
                   
                        </select>
                    </div>
                </div>
           </div>
           
            
       <div class="span9">
           
            
            <div class="span3">
        
                <div class="control-group">
                    <label class="control-label">Dia Visita(*)</label>
                    <div class="controls">
                        <select id="dia_lista" name="dia_lista" required class="input-medium" >
                            <option value="Lunes">Lunes</option>
                            <option value="Martes">Martes</option>
                            <option value="Miercoles">Miercoles</option>
                            <option value="Jueves">Jueves </option>
                            <option value="Viernes">Viernes </option>
                            <option value="Sabado">Sabado</option>
                            <option value="Domingo">Domingo</option>
                        </select>
                    </div>
                </div>
            </div>
       
           <div class="span3" >
            <div class="control-group" >
                <label class="control-label">Hora Visitas (*)</label>
                <div class="controls">
                    <input type="time" id="inputHora" name="inputHora" value="{{persona.hora}}" required class="input-medium">                       
                </div>
            </div>
           </div>
          
           
       </div>
            
       {% if is_granted('ROLE_LIDER_RED') %}
        <div class="span9">
            
            <div class="control-group">
                <label class="control-label">Ganado por</label>
                <input type="hidden" id="ganador_id" name="ganador_id" value="{{persona.ganadoPor}}">
                <div class="controls">
                    <input type="text" id="ganador" name="ganador" class="input-xxlarge" value="{{ganado}}" >
                </div>
            </div>
           
            
        </div>    
      
        {% endif %}
    </fieldset>
            
            
   <fieldset>
                <legend>Descripción</legend>
                
               <div class="control-group">
                    <label class="control-label">Descripción</label>
                    <div class="controls">
                        <textarea rows="5" id="inputDescripcion" name="inputDescripcion" value="" class="input-xxlarge" required>{{persona.peticion}} </textarea>
                    <p class="help-block">Pedido de oración u otro detalle</p>
                    </div>
                </div>          
            
   </fieldset>

   <div class="control-group">
        <div class="controls">
        	<input class="btn btn-primary" type="submit" id="btnGuardar" name="btnGuardar" value="Registrar" />
        </div>
   </div>
              
   </form>
        

</div>
{% endblock %}

        
        
  {%block javascript %}
  	<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.js"></script>
	<script src="http://d19k46zntalu3t.cloudfront.net/js/less.js"></script>
	<script src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.js"></script>
	<script src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.min.js"></script>
	<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.peity.js"></script>
	<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.fancybox.js"></script>
	<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.flot.js"></script>
	<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.color.js"></script>
	<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.flot.resize.js"></script>
	<script src="http://d19k46zntalu3t.cloudfront.net/js/custom.js"></script>            
         <script src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.datepicker.js"></script>
  	<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.inputmask.min.js"></script>
        <script src="http://d19k46zntalu3t.cloudfront.net/js/util/functiongen.js"> </script>
        <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.core.min.js"></script>
        <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.widget.min.js"></script>
        <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.position.min.js"></script>
        <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.autocomplete.min.js"></script>

            
            <script type="text/javascript">
                
                ubigeos = null ;
                redes = null;
                lugares = null;
                personas = null;
                
                var PrepararDatosVisitante, SuccessFunction, root;

                root = typeof exports !== "undefined" && exports !== null ? exports : this;

                root.DatosEnviar = null;

                root.count = 0;

                root.SelectToDrop = null;

                root.TipoForm = null;

                PrepararDatos = function() {
                    return root.DatosEnviar = {
                            "formulario": $("#form_persona").serializeObject()
                    };
                };

                SuccessFunction = function(data) {
                    if(data.responseCode===200 ){          
                      
                        $("#form_persona").reset();
                        cargarUbigeo(ubigeos, "distrito_lista", "provincia_lista", "departamento_lista", {{distrito.intUbigeoId}}, 
                        {{provincia.intUbigeoId}}, {{departamento.intUbigeoId}});
                 
                 
                        cargarSelect(redes, "red_lista", "int_red_id", "id");
                        cargarSelect(lugares, "lugar", "int_lugar_id", "var_lugar_descripcion");
                        
                        alert('Registro Completado');
                        
                        window.close();
                        
                    }
                    else if(data.responseCode===400){//bad request
                       alert('Error bad request');
                        }
                    else{                        
                        if(data.responseCode===500)
                        {
                            alert('Error bad request');
                        }
                        else alert("An unexpeded error occured.");
                        }
                    
                };

                
             function ganador_autocomplete_red()
             {
                 
                 if($("#red_lista").val() == '-1')
                 {
                    // personas = getAjaxObject('{{path('services_ganadores_autocomplete_all')}}');
                 }
                 else
                 {
                     //recargar celula
                     //recargar ganador
                     //nuevo convertido
                     
                     url = '{{path( 'services_ganadores_autocomplete_red', {'red':'cod'} )}}';
                     url = url.replace('cod',$("#red_lista").val());
             
                     personas = getAjaxObject(url);
                     
                     $("#ganador").autocomplete({
                        source: personas,
                        select: function(event, ui) {
                            $("#ganador_id").val(ui.item.id);
                            $("#ganador").val(ui.item.label);
                            return false;
                        }
                    });
                    
                    $("#ganador_id").val(-1);
                 }
                 
             }
            

            $(document).ready(function(){
                 
                 
                 ubigeos = getAjaxObject("https://s3.amazonaws.com/adminchurchs3/json/ubi.json");
                 cargarUbigeo(ubigeos, "distrito_lista", "provincia_lista", "departamento_lista", {{distrito.intUbigeoId}}, 
                        {{provincia.intUbigeoId}}, {{departamento.intUbigeoId}});
                 
                 redes = getAjaxObject('{{path('services_red')}}');
                 lugares = getAjaxObject('{{path('services_lugar')}}');
                 
                 cargarSelect(redes, "red_lista", "int_red_id", "id");
                 cargarSelect(lugares, "lugar", "int_lugar_id", "var_lugar_descripcion");
                 
                 
                 
                 $("#select_Civil").val("{{persona.estadoCivil}}");
                 $("#select_Sexo").val("{{persona.sexo}}");
                 
                 $("#red_lista").val({{persona.red.intRedId}});
                 $("#lugar").val({{persona.lugar.intLugarId}});
                 $("#dia_lista").val("{{persona.dia}}");
                 
                 
                 
          
                 //cambiar red
                 $("#red_lista").change(function(){
                     //cambiar célula
                     
                     //cambiar ganadores x red
                     
                     ganador_autocomplete_red();
                 });
                
                 $("#form_persona").submit(function(event) {
                    event.preventDefault();
                    PrepararDatos();
                    return enviar('{{path('editar_gana_save')}}', root.DatosEnviar, SuccessFunction, null);
  
                });

            });
           
           
     
            </script>             
     {%endblock%}
            
  