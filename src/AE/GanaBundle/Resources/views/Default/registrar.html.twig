{% extends "::base.html.twig" %}

{% block titulo %}Registrar Nuevo - {% endblock %}

{% block stylesheets %}
<link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap-responsive.css" media="screen" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.datepicker.css">
<link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/smooth/jquery-ui-1.8.16.custom.css" >
<link href="{{asset('css/validationEngine.jquery.css')}}" media="screen" rel="stylesheet" type="text/css">
<link href="{{asset('css/style.css')}}" media="screen" rel="stylesheet" type="text/css">
{% endblock %}
           
{% block content %}
<div class="span9" id="registro_form">
    <h1>Registrar Nuevo</h1>
    <br>
    <form class="form-horizontal" action="{{path('ae_gana_persona')}}" method="POST" id="form_persona" name="form_persona">

        <fieldset>
            <legend>Datos Personales</legend>
            <input type="hidden" id="duplicado" name="duplicado" value="0">
            <div class="span9">
                <div class="control-group" >
                    <label class="control-label">Nombres (*)</label>
                    <div class="controls">
                        <input type="text" id="inputNombres" name="inputNombres" placeholder="Nombres" class="input-xxlarge validate[required,custom[onlyLetterSp]]" required="true" required />
                    </div>
                </div>

                <div class="control-group" >
                    <label class="control-label">Apellidos (*)</label>
                    <div class="controls">
                        <input type="text" id="inputApellidos" name="inputApellidos" placeholder="Apellidos" class="input-xxlarge validate[required,custom[onlyLetterSp]]" required />
                    </div>
                </div>
            </div>

            <div class="span9">
                <div class="span4" style="margin: 0;">
                    <div class="control-group">
                        <label class="control-label" >Fecha nacimiento (*)</label>
                        <div class="controls">
                            <input type= "text" class="validate[required] datepicker input-medium" id="inputFechaNacimiento" name="inputFechaNacimiento"/>
                            <p class="help-block">Día/Mes/Año</p>
                        </div>
                    </div>
                </div>

                <div class="span4">

                    <div class="control-group">
                        <label class="control-label" >Edad (*)</label>
                        <div class="controls">
                            <input type="number" class="input-small validate[required,custom[onlyNumberSp],maxSize[2],minSize[2]]" placeholder="Edad" id="inputEdad" name="inputEdad" required/>
                        </div>
                    </div>
                </div>
            </div>

            <div class="span9">

                <div class="span4" style="margin: 0;">

                    <div class="control-group ">
                        <label class="control-label" for="select02">Estado Civil (*)</label>
                        <div class="controls">
                            <select id="select_Civil" name="select_Civil" required class="input-medium">
                                <option value="0">Solter@</option>
                                <option value="1">Casad@</option>
                                <option value="2">Conviviente</option>
                                <option value="3">Viud@</option>
                                <option value="4">Divorciado</option>
                                <option value="5">Madre Soltera</option>

                            </select>
                        </div>
                    </div>

                </div>
                <div class="span4">
                    <div class="control-group">
                        <label class= "control-label" for="select01">Sexo (*)</label>
                        <div  class="controls">
                            <select name="select_Sexo" id="select_Sexo" required class="input-medium">
                                <option value="1">Masculino</option>
                                <option value="2">Femenino</option>
                            </select>
                        </div>
                    </div>
                </div>

            </div>

            <div class="span9">
                <div class="span4" style="margin: 0;">
                    <div class="control-group">
                        <label class="control-label" >DNI (*)</label>
                        <div class="controls">
                            <input type="text" class="input-medium validate[required,custom[onlyNumberSp],maxSize[8],minSize[8]]" placeholder="DNI" id="inputDni" name="inputDni" pattern="[0-9]{8}" required />
                            <p class="help-block">8 digitos</p>
                        </div>
                    </div>
                </div>
                <div class="span4">
                    <div class="control-group">
                        <label class="control-label" >Ocupación (*)</label>
                        <div class="controls">
                            <input type="text" class="input-medium validate[required,custom[onlyLetterSp]]" placeholder="Ocupación" id="inputOcupacion" name="inputOcupacion" required />
                        </div>
                    </div>

                </div>
            </div>

            <div class="span9">

                <div class="span4" style="margin: 0;">
                    <div class="control-group">
                        <label class="control-label" >Teléfono</label>
                        <div class="controls">
                            <input type="text" class="input-medium validate[custom[onlyNumberSp],maxSize[9],minSize[9]]" placeholder="Telefono" id="inputTelefono" name="inputTelefono" />
                            <p class="help-block">0CódigoNúmero</p>
                        </div>
                    </div>

                </div>

                <div class="span4">
                    <div class="control-group">
                        <label class="control-label" >Celular</label>
                        <div class="controls">
                            <input type="text" class="input-medium" placeholder="Celular" id="inputCelular" name="inputCelular" />
                            <p class="help-block">9 digitos</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="span9">

                <div class="span4" style="margin: 0;">
                    <div class="control-group">
                        <label class="control-label" >Email</label>
                        <div class="controls">
                            <input type="text" id="inputEmail" name="inputEmail" placeholder="Email" class="input-medium validate[custom[email]]" />
                        </div>
                    </div>
                </div>
            </div>

        </fieldset>

        <fieldset>
            <legend>Ubicación</legend>

            <div class="span9">
                <div class="control-group">
                    <label class="control-label">Dirección (*)</label>
                    <div class="controls">
                        <input type="text" class="input-xxlarge validate[required]" id="inputDireccion" name="inputDireccion" required />
                    </div>
                </div>
            </div>
            <div class="span9">
                <div class="control-group">
                    <label class="control-label">Referencia</label>
                    <div class="controls" >
                        <input type="text" class="input-xxlarge" id="inputReferencia" name="inputReferencia" />
                    </div>
                </div>
            </div>

            <div class="span12">
                <div class="span3" style="margin: 0;">
                    <div class="control-group">
                        <label class="control-label" >Departamento (*)</label>
                        <div class="controls">
                            <select name="departamento_lista" id="departamento_lista" required  class="input-medium"></select>
                        </div>
                    </div>
                </div>

                <div class="span3">
                    <div class="control-group">
                        <label class="control-label" >Provincia (*)</label>
                        <div class="controls">
                            <select name="provincia_lista" id="provincia_lista" required class="input-medium"></select>
                        </div>
                    </div>
                </div>

                <div class="span3">

                    <div class="control-group">
                        <label class="control-label">Distrito (*)</label>
                        <div class="controls">
                            <select name="distrito_lista" id="distrito_lista" required class="input-medium"></select>
                        </div>
                    </div>
                </div>
            </div>

        </fieldset>
        <fieldset>
            <legend>Iglesia</legend>

            <div class="span9">

                <div class="span4" style="margin: 0;">
                    <div class="control-group">
                        <label class="control-label" >Red</label>
                        <div class="controls">
                            <select id="red_lista" name="red_lista" class="input-medium" ></select>
                        </div>
                    </div>
                </div>

                <div class="span4">
                    <div class="control-group">
                        <label class="control-label">Asiste a Célula</label>
                        <div class="controls">
                            <label class="radio">
                                <input type="radio" id="celula" name="celula" value="si">Si</label>
                            <label class="radio">
                                <input type="radio" id="celula" name="celula" value="no">No</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="span9">
                <div class="span4" style="margin: 0;">
                    <div class="control-group">
                        <label class="control-label">Fecha Conversión (*)</label>
                        <div class="controls">
                            <input type= "text" class="datepicker input-medium" id="inputFechaConversion"
                        name="inputFechaConversion" required/>
                            <p class="help-block">Día/Mes/Año</p>
                        </div>
                    </div>
                </div>

                <div class="span4">
                    <div class="control-group">
                        <label class="control-label">Lugar (*)</label>
                        <div class="controls">
                            <select id="lugar" name="lugar" required class="input-medium"></select>
                        </div>
                    </div>
                </div>
            </div>
                <div class="span9">

                    <div class="span4" style="margin: 0;">
                        <div class="control-group">
                            <label class="control-label">Dia Visita(*)</label>
                            <div class="controls">
                                <select id="dia_lista" name="dia_lista" required class="input-medium" >
                                    <option value="Lunes">Lunes</option>
                                    <option value="Martes">Martes</option>
                                    <option value="Miercoles">Miercoles</option>
                                    <option value="Jueves">Jueves</option>
                                    <option value="Viernes">Viernes</option>
                                    <option value="Sabado">Sabado</option>
                                    <option value="Domingo">Domingo</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="span4" >
                        <div class="control-group" >
                            <label class="control-label">Hora Visitas (*)</label>
                            <div class="controls">
                                <input type="time" id="inputHora" name="inputHora" value="00:00:00" required class="input-medium"></div>
                        </div>
                    </div>

                </div>
                {% if is_granted('ROLE_LIDER_RED') %}
                <div class="span9">

                    <div class="control-group">
                        <label class="control-label">Ganado por</label>
                        <input type="hidden" id="ganador_id" name="ganador_id">
                        <div class="controls">
                            <input type="text" id="ganador" name="ganador" class="input-xxlarge" ></div>
                    </div>

                </div>
                {% endif %}
            </fieldset>

            <fieldset>
                <legend>Descripción</legend>
                <div class="span9">
                    <div class="control-group">
                        <label class="control-label">Descripción</label>
                        <div class="controls">
                            <textarea rows="5" id="inputDescripcion" name="inputDescripcion" class="input-xxlarge" required></textarea>
                            <p class="help-block">Pedido de oración u otro detalle</p>
                        </div>
                    </div>
                </div>
                <div class="span9">
                    <div class="control-group">
                        <div class="controls">
                            <input class="btn btn-primary" type="submit" id="btnGuardar" name="btnGuardar" value="Registrar" />
                        </div>
                    </div>
                </div>
            </fieldset>

        </form>

    </div>
    {% endblock %}

        
        
  {%block javascript %}
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/less.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.min.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.peity.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.fancybox.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.flot.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.color.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.flot.resize.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/custom.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.datepicker.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.inputmask.min.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/util/functiongen.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.core.min.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.widget.min.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.position.min.js"></script>
    <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.autocomplete.min.js"></script>
    <script src="{{asset('js/jquery.validationEngine-es.js')}}"></script>
    <script src="{{asset('js/jquery.validationEngine.js')}}"></script>

    <script type="text/javascript">
                
                ubigeos = null ;
                redes = null;
                lugares = null;
                personas = null;
                
                var PrepararDatosVisitante, SuccessFunction, root;

                root = typeof exports !== "undefined" && exports !== null ? exports : this;
                root.SourceTServicio = "/recuperar_personas_inicio";
                root.DatosEnviar = null;
                root.count = 0;
                root.SelectToDrop = null;
                root.TipoForm = null;

                PrepararDatos = function() {
                    return root.DatosEnviar = {
                            "formulario": $("#form_persona").serializeObject()
                    };
                };

                SuccessFunction = function(data) {
                    if(data.responseCode===200 ){          
                      
                        $("#form_persona").reset();
                        alert('Registro Completado');
                        
                        root.count++;
                        
                        if(root.count == 20)
                        {
                            location.reload();
                            root.count = 0;
                        }
                        
                        if(root.count%10 == 0)
                        {
                            $("#ganador").autocomplete({
                                source: personas,
                                select: function(event, ui) {
                                    $("#ganador_id").val(ui.item.id);
                                    $("#ganador").val(ui.item.label);
                                    return false;
                                }
                            });
                        }
                        $("#ganador_id").val(-1);
                        
                    }
                    else if(data.responseCode===400){//bad request
                       alert('Error bad request');
                        }
                    else{                        
                        if(data.responseCode===500)
                        {
                            alert('Error bad request');
                        }
                        else alert("An unexpeded error occured.");
                        }
                    
                };

                
             function ganador_autocomplete_red()
             {
                 
                 if($("#red_lista").val() == '-1')
                 {
                    // personas = getAjaxObject('{{path('services_ganadores_autocomplete_all')}}');
                 }
                 else
                 {
                     //recargar celula
                     //recargar ganador
                     //nuevo convertido
                     
                     url = '{{path( 'services_ganadores_autocomplete_red', {'red':'cod'} )}}';
                     url = url.replace('cod',$("#red_lista").val());
             
                     personas = getAjaxObject(url);
                     
                     $("#ganador").autocomplete({
                        source: personas,
                        select: function(event, ui) {
                            $("#ganador_id").val(ui.item.id);
                            $("#ganador").val(ui.item.label);
                            return false;
                        }
                    });
                    
                    $("#ganador_id").val(-1);
                 }
                 
             }
            

            $(document).ready(function(){
                var nowTemp = new Date();
                var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);
                $(".datepicker").datepicker({
                    format: "dd/mm/yyyy",
                    onRender: function(date) {
                        return date.valueOf() > now.valueOf() ? "disabled" : "";
                    }
                });

                $("form").validationEngine();

                $("#inputFechaNacimiento").change(function() {
                    inputvalue = $("#inputFechaNacimiento").val(); 
                    anioinput =inputvalue.split('/');
                    edad = nowTemp.getFullYear() - anioinput[2];
                    console.log(anioinput);
                    $('#inputEdad').val(edad);
                });
                 
                 ubigeos = getAjaxObject("https://s3.amazonaws.com/adminchurchs3/json/ubi.json");
                 cargarUbigeo(ubigeos, "distrito_lista", "provincia_lista", "departamento_lista");
                 
                 redes = getAjaxObject('{{path('services_red')}}');
                 lugares = getAjaxObject('{{path('services_lugar')}}');
                 
                 cargarSelect(redes, "red_lista", "int_red_id", "id");
                 cargarSelect(lugares, "lugar", "int_lugar_id", "var_lugar_descripcion");
          
                 //cambiar red
                 $("#red_lista").change(function(){
                     //cambiar célula
                     ganador_autocomplete_red();
                 });
                
                 $("#form_persona").submit(function(event) {
                    event.preventDefault();
                    PrepararDatos();

                    
                    enviar('{{path('ae_gana_persona')}}', root.DatosEnviar, SuccessFunction, null);
  
                });

            });
           
           
     
            </script>
    {%endblock%}