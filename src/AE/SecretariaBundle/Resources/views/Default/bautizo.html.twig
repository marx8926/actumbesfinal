{% extends "::base.html.twig" %}
{% block stylesheets %}
<link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://d19k46zntalu3t.cloudfront.net/css/style.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap-responsive.css" media="screen" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.datepicker.css">

<link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/smooth/jquery-ui-1.8.16.custom.css" >

<!-- Scripts -->
{% endblock %}
        
{% block content %}
<div class="container-fluid">
    <div class="content">

        <div class="row-fluid">
            <div class="span12">
                <div class="box">
                    <div class="box-head tabs">
                        <h3>Registro Bautizo</h3>
                        <ul class="nav nav-tabs">
                            <li class='active'>
                                <a href="#basic" data-toggle='tab'>Información Básica</a>
                            </li>

                        </ul>
                    </div>
                    <div class="box-content">
                        <form action="#" class="form-horizontal" id="form_bautizo" name="form_bautizo" method="POST">
                            <div class="tab-content">
                                <div class="tab-pane active" id="basic">

                                    <div class="row">

                                        <div class="span3">
                                            <div class="control-group">
                                                <label for="f_inicio" class="control-label">Fecha</label>
                                                <div class="controls">
                                                    <input type="text" class="input-small datepick" id="f_inicio" name="f_inicio" required></div>
                                            </div>
                                        </div>
                                        <div class="span3">
                                            <div class="control-group">
                                                <label for="h_inicio" class="control-label">Hora</label>
                                                <div class="controls">
                                                    <input type="time" class="input-small" id="h_inicio" name="h_inicio" required value="11:00"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">

                                        <div class="control-group">
                                            <label for="lugar" class="control-label">Lugar</label>
                                            <div class="controls">
                                                <input type="text" id="lugar" name="lugar" class="input-xxlarge" required></div>
                                        </div>
                                    </div>

                                    <div class="row">

                                        <div class="control-group">
                                            <label for="pastor" class="control-label">Pastor</label>
                                            <div class="controls">
                                                <input type='text' id='pastor' name='pastor' required class='input-xxlarge' ></div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="control-group">
                                            <label for="red_lista" class="control-label">Red</label>
                                            <div class="controls">
                                                <select id="red_lista" name="red_lista"></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="control-group">
                                            <label class="control-label">Persona</label>
                                            <input id="persona_id" name="persona_id" type="hidden">

                                            <div class="controls">
                                                <input id="persona" name="persona" class="input-large" type="text" >
                                                <input type="button" class="btn btn-small" value="+" id="add_persona" name="add_persona"></div>
                                        </div>
                                    </div>

                                </div>

                            </div>
                            <div class="form-actions">
                                <input type="submit" class='btn btn-primary' value="Guardar" id="btnGuardarCelula" name="btnGuardarCelula">
                                <input type="reset" class='btn btn-danger' value="Cancelar"></div>
                        </form>

                        <div >
                            <table class='table table-condensed table-striped table-hover table-bordered pull-left' id='table_personas' name="table_personas">
                                <thead>
                                    <tr>
                                        <th style='width:16%'>ID</th>
                                        <th style='width:43%'>Persona</th>
                                        <th style='width:17%'>Red</th>
                                        <th class='hidden-phone' style='width:23%'>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class='row-fluid'>
            <div class='span12'>
                <div class='box'>
                    <div class='box-head'>
                        <h3>Bautizos realizados</h3>
                    </div>
                    <div class='box-content box-nomargin'>
                        <table id="tabla_bautizo" name="tabla_bautizo" class='table table-striped table-bordered'>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Hora</th>
                                    <th>Pastor</th>
                                    <th># bautizados</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
      
               
{%block javascript %}
<script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/jquery.js"></script>
<script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-typeahead.js"></script>
<script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-collapse.js"></script>
<script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-button.js"></script>
<script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-tooltip.js"></script>
<script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-tab.js"></script>
<script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.js"></script>
<script src="http://d19k46zntalu3t.cloudfront.net/js/custom.js"></script>
<!--[if lt IE 9]>
<script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/html5.js"></script>
<![endif]-->
<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.core.min.js"></script>
<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.widget.min.js"></script>
<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.position.min.js"></script>
<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.autocomplete.min.js"></script>
<script src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.datepicker.js"></script>

<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.sparkline.js"></script>
<script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.dataTables.js"></script>
<script src="http://d19k46zntalu3t.cloudfront.net/js/custom-tables.js"></script>
<script src="http://d19k46zntalu3t.cloudfront.net/js/util/datatable_plugins.js"></script>
<script src="{{asset('js/util/functiongen.js')}}"></script>

<script type="text/javascript">          
    var redes = null;
    var urlES = "https://s3.amazonaws.com/acfinal/dt_ES.txt";
    var SourceTServicio = "{{path('servicio_bautizos_all')}}";
    var DatosEnviar = null;
    var personas = null;
    var personasTabla = null;
    var bautismos = null;       
    var columnas_lecciones = [
        {"mDataProp": "fecha"},
        {"mDataProp": "hora"},
        {"mDataProp": "pastor"},
        {"mDataProp": "num"},
        {"mDataProp": "acciones"}];
              
    persona_cambio_red = function()
    {
        red = $("#red_lista").val();
        console.log(red);
        
        if(red != '-1')
        {
            url = '{{path( 'services_sinbautizo_autocomplete_red',{'red':'nom'})}}';
            url = url.replace('nom',red);
                            
            personas = getAjaxObject(url);
                            
            $("#persona").autocomplete({
                source: personas,
                select: function(event, ui) {
                        $("#persona_id").val(ui.item.id);
                        $("#persona").val(ui.item.label);
                        return false;
                }
            }); 
        }       
    };

    PrepararDatos = function()
    {
        return DatosEnviar = {
            "formulario": $("#form_bautizo").serializeObject(),
            "tabla" : personasTabla.fnGetData()
        };
    };

    SuccessFunction = function(data) 
    {
        if(data.responseCode===200 )
        {
            $("#form_bautizo").reset();
            alert('Registro Completado');
            personasTabla.fnClearTable();
        }
        else
        {
            if(data.responseCode===400)
            {
                alert('Error bad request');
            }
            else
            {
                if(data.responseCode===500)
                {
                    alert('Error bad request');
                }
                else
                    alert("An unexpeded error occured.");
            }
        }
    };
        
    $(document).ready(function()
    {
        redes = getAjaxObject('{{path('services_red')}}');
        cargarSelect(redes, "red_lista", "int_red_id", "id");
        personasTabla = $('#table_personas').dataTable({
            "aoColumns":[
                {"mDataProp": "id"}, 
                {"mDataProp": "persona"},
                {"mDataProp": "red"},
                {"mDataProp": "btn_elim"}],
            "bPaginate": false,
            "sDom": "<r>t<'row-fluid'>",
            "fnCreatedRow": function(nRow, aData, iDisplayIndex)
            {
                $(nRow).find('.delete-row').click(function(event)
                {
                    event.preventDefault();
                    var index;
                    index = $(personasTabla.fnGetData()).getIndexObj(aData, 'id');
                    personasTabla.fnDeleteRow(index);
                });
            }
        });

        $('#add_persona').click(function(event)
        {
            var num, leccion;
            event.preventDefault();
            if ($("#persona").val().length > 0 && $("#persona_id").val()!= '-1')
            {
                leccion = {
                    "id": $("#persona_id").val(),
                    "persona": $("#persona").val(),
                    "red": $("#red_lista option:selected").text(),
                    "btn_elim": getActionButtons("001")
                };

                personasTabla.fnAddData(leccion);
                $("#persona").val("");
                $("#persona_id").val(-1);
                return false;
            }
        });

        $("#form_bautizo").submit(function(event)
        {
            event.preventDefault();
            PrepararDatos();
            if(personasTabla.length > 0)
            {
                return enviar('{{path('bautizo_save')}}', DatosEnviar, SuccessFunction, null);
            }
            else
                alert('Seleccione una persona');

        });            
        $("#red_lista").change(persona_cambio_red);
        bautismos = createDataTable("tabla_bautizo",SourceTServicio,columnas_lecciones,null,null);
    });

</script>
{%endblock %}{# empty Twig template #}