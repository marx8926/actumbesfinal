{% extends "::base.html.twig" %}
        {% block stylesheets %}
        <link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.css" media="screen" rel="stylesheet" type="text/css">
        <link href="http://d19k46zntalu3t.cloudfront.net/css/style.css" media="screen" rel="stylesheet" type="text/css">
        <link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap-responsive.css" media="screen" rel="stylesheet" type="text/css">
       <link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.datepicker.css">
        <link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/smooth/jquery-ui-1.8.16.custom.css" >
        {% endblock %}
        
{% block content %}

       <div class="container-fluid">
        <div class="content">
          
            <div class="row-fluid">
                <div class="span12">
                    <div class="box">
                        <div class="box-head tabs">
                            <h3>Registro Estudiante</h3>
                            <ul class="nav nav-tabs">
                                <li class='active'>
                                    <a href="#basic" data-toggle='tab'>Información Básica</a>
                                </li>
                               
                            </ul>
                        </div>
                        <div class="box-content">
                            <form action="#" class="form-horizontal" id="form_docente" name="form_docente" method="POST">
                            <div class="tab-content">
                                <div class="tab-pane active" id="basic">
                                    
                                        <div class="control-group">
                                            <label for="red_lista" class="control-label">Red</label>
                                            <div class="controls">
                                                <select id="red_lista" name="red_lista">
                                                    
                                                </select>
                                                <input type="button" class="btn btn-success" value="Generar" id="generar" name="generar">
                                            </div>
                                        </div>
                                    
                                        <div class="control-group">
                                            <label class="control-label"> Persona</label>
                                            <input id="persona_id" name="persona_id" type="hidden">

                                            <div class="controls">
                                                <input id="persona" name="persona" class="input-large" type="text" >
                                            </div>
                                        </div>
                                    
                                       <div class="control-group">
                                            <label class="control-label">Fecha</label>
                                            <div class="controls">
                                                <input type= "text" class="datepick input-medium" id="fecha"
                                                    name="fecha" required/>
                                                <p class="help-block">Día/Mes/Año</p>  
                                            </div>
                                        </div>                                      
                                </div>                              
                                
                            </div>
                                <div class="form-actions">
                                    <input type="submit" class='btn btn-primary' value="Añadir" id="btnGuardarCelula" name="btnGuardarCelula">
                                    <input type="reset" class='btn btn-danger' value="Cancelar">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>       
            
            <div class="row-fluid">
                <div class="span12">
                    <div class="box">
                
                        <div class="box-head">
                            <h3>Estudiantes registrados</h3>
                             <div class="actions">
				<ul>
                                                       
                                   <li>
                                        <form id="reporte_form" name="reporte_form" method="POST" action="{{path('discipula_informe_estudiantes_red')}}">
                                            <input type="hidden" id="net" name="net" value="-1">
                                            <input type="hidden" id="net_name" name="net_name">
                                            <button type="submit" id='excelbutton' class="btn btn-mini btn-square tip">
                                                 <i class="icon-hdd"></i>
                                                  Guardar
                                            </button>
                                        </form>
                                   </li>
				</ul>	
                            </div>
                        </div>
       

                        <div class="box-content box-nomargin">
                            
                            
                            <div class="modal hide" id="delete_modal">
                            
                                <form class="form-horizontal" id="form_descartar" name="form_descartar" >
                                
                                    <input type="hidden" id="descartar_id" name="descartar_id">
                                    <div class="modal-header">
                                        <button type="button" class="close" data-dismiss="modal">×</button>
                                        <h3>Confirmación</h3>
                                    </div>
                                    <div class="modal-body">
                                        <p id="posible_descarte"></p>
                               
                                    </div>
                                    <div class="modal-footer">
                                                             
                                        <a href="#" class="btn" data-dismiss="modal">Descartar</a>
                                        <input type="button" value="Guardar cambios" id="guardar_descartar" name="guardar_descartar" class="btn btn-primary" data-dismiss="modal" >
                                    </div>
                                </form>
                            </div>
         
                           	<table cellpadding="0" cellspacing="0" border="0" class="data-table table table-condensed table-striped table-hover table-bordered pull-left"  id="tabla_docente" name="tabla_docente">
                                    <thead id='lol'>
                                        <tr>
                                            <th width='35%'>Nombre</th>
                                            <th>Red</th>
                                            <th>Inicio</th>
                                            <th>Estado</th>
                                            <th>Acciones</th>               
		                </tr>
			</thead>
                </table>
                </div>
            </div>
     
     </div>
    </div>

    
        </div>  
    </div>
        
{% endblock %}
      
               
      {%block javascript %}
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/jquery.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-typeahead.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-collapse.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-button.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-tooltip.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-tab.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.js"></script>    
            <script src="http://d19k46zntalu3t.cloudfront.net/js/custom.js"></script>              
            <!--[if lt IE 9]> <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/html5.js"></script><![endif]-->
            <script src="http://d19k46zntalu3t.cloudfront.net/js/util/functiongen.js"> </script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.core.min.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.widget.min.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.position.min.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.autocomplete.min.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.datepicker.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.sparkline.js"> </script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.dataTables.js"> </script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/custom-tables.js"> </script>
            
            <script src="http://d19k46zntalu3t.cloudfront.net/js/util/functiongen.js"> </script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/util/datatable_plugins.js"></script>
            <script src="{{asset('js/otherfunctiondatatable.js')}}"></script>
      
      <script type="text/javascript">
          
                $redes = null;
                root = typeof exports !== "undefined" && exports !== null ? exports : this;

                root.SourceTServicio = "/recuperar_personas_inicio";

                root.DatosEnviar = null;
                personas = null;
                root.count = 0;
                var ProfesorTable;
                root.SourceEServicio = "";
                
                
                  urlES = "https://s3.amazonaws.com/acfinal/dt_ES.txt";
                
                FormatoProfesorTable = [
                {                
                    "mDataProp": "nombres"
                },
                {
                    "mDataProp": "red"
                },{
                    "mDataProp": "inicio"
                },
                {
                    "mDataProp": "estado"
                },            
                {
                    "mDataProp": "acciones"
                }
                ]; 
                
                
                ProfesorRowCB = function(nRow, aData, iDisplayIndex) {
                    var acciones, index;
                    index = $(ProfesorTable.fnGetData()).getIndexObj(aData, 'id');
       
                    {% if is_granted('ROLE_DISCIPULAR')  %}
                        acciones =  cambiar_ver_estado("delete_modal", "");         
                    {% endif %}
                        
                    ProfesorTable.fnUpdate(acciones, index, 4);
                    $(nRow).find('a').tooltip('hide');

                    $(nRow).find('.estado-row').click(function(event){                
                        event.preventDefault();
                        if(aData.activo == true)
                            $("#posible_descarte").text("Desea desactivar al estudiante "+ aData.nombres + "?");                
                        else
                            $("#posible_descarte").text("Desea activar al estudiante "+ aData.nombres + "?");
               
                        $("#descartar_id").val(aData.niv_id);
                    });
                    
                    $(nRow).find('.ver-row').click(function(event){                
                        event.preventDefault();                        
                        //resumen de curso
                        $("#descartar_id").val(aData.niv_id);
                    });
      
                };
        
      
        
                generar_data= function()
                {
                    var red = $("#red_lista").val();
                    if(red != '-1')
                    {
                        if(root.count == 0)
                        {
                            root.count++;
                            url = "{{path('services_estudiante_red_table',{'red':'net'})}}";
                            url = url.replace('net', red);
                            ProfesorTable = createDataTable("tabla_docente", url, FormatoProfesorTable, null, ProfesorRowCB);

                            root.SourceEServicio = url;
                        }
                        else
                        {
                            url = "{{path('services_estudiante_red_table',{'red':'net'})}}";
                            url = url.replace('net', red);
                            root.SourceEServicio = url;
                            ProfesorTable.fnReloadAjax(root.SourceEServicio);
                        }
                    }
                    $("#net_name").val($("#red_lista option:selected").text());
                    $("#net").val(red);
                    
                };
                PrepararDatos = function() {
                    return root.DatosEnviar = {
                            "formulario": $("#form_docente").serializeObject()
                    };
                };
                
                SuccessTablaFunction = function(data) {
                   
                    if(data.responseCode===200 ){                        
                       alert('Registro Completado');
                        ProfesorTable.fnReloadAjax(root.SourceEServicio);
                    }
                    else if(data.responseCode===400){//bad request
                        alert('Error bad request');
                        }
                    else{                        
                        if(data.responseCode===500)
                        {
                            alert('Error bad request');
                        }
                        else alert("An unexpeded error occured.");
                        }
                    
                };

                SuccessFunction = function(data) {
                                        
                    if(data.responseCode===200 ){          
                      
                       $("#form_docente").reset();
                       
                       cargarSelect(redes, "red_lista", "int_red_id", "id");
                        
                        alert('Registro Completado');
                                     
                        $("#persona_id").val(-1);
                        ProfesorTable.fnClearTable();
                        ProfesorTable.fnReloadAjax(root.SourceEServicio);

                        
                    }
                    else if(data.responseCode===400){//bad request
                        alert('Error bad request');
                        }
                    else{                        
                        if(data.responseCode===500)
                        {
                            alert('Error bad request');
                        }
                        else alert("An unexpeded error occured.");
                        }
                    
                };

    
        persona_cambio_red = function()
        {
            red = $("#red_lista").val();
            
            if(red != '-1')
            {
                url = '{{path( 'services_persona_noestudiante_autocomplete_red',{'red':'nom'})}}';
                url = url.replace('nom',red);
                                
                personas = getAjaxObject(url);                     
                $("#persona").autocomplete({
                    source: personas,
                    select: function(event, ui) {
                            $("#persona_id").val(ui.item.id);
                            $("#persona").val(ui.item.label);
                            return false;
                    }
                }); 
            }
           
        };
        
	$(document).ready(function() {
            
                 
            redes = getAjaxObject('{{path('services_red')}}');
                          
            cargarSelect(redes, "red_lista", "int_red_id", "id");
                     
            $("#form_docente").submit(function(event){
                
                 event.preventDefault();
                 PrepararDatos();
                 console.log(root.DatosEnviar);
                 if($("#persona_id").val() != '-1')
                    return enviar('{{path('estudiante_save')}}', root.DatosEnviar, SuccessFunction, null);
                else alert('Seleccione una persona');
  
            });
            
            $("#red_lista").change(persona_cambio_red);
            
            $("#generar").click(function(event){
                event.preventDefault();
                generar_data();
            });
            
             $("#guardar_descartar").click(function(event){
             
                 enviar('{{path('estudiante_delete')}}', {'formulario': $("#descartar_id").val()}, SuccessTablaFunction, null);
            });
        
        } );

       </script>
      {%endblock %}