{% extends "::base.html.twig" %}
        {% block stylesheets %}
        <link href="{{asset('css/bootstrap.css')}}" media="screen" rel="stylesheet" type="text/css">
        <link href="{{asset('css/style.css')}}" media="screen" rel="stylesheet" type="text/css">
        <link href="{{asset('css/bootstrap-responsive.css')}}" media="screen" rel="stylesheet" type="text/css">
       <link rel="stylesheet" href="{{asset('css/bootstrap.datepicker.css')}}">
        <link rel="stylesheet" href="{{asset('css/smooth/jquery-ui-1.8.16.custom.css')}}" >
        <!-- Scripts -->
                 
        {% endblock %}
        
{% block content %}

       <div class="container-fluid">
        <div class="content">
          
            <div class="row-fluid">
                <div class="span12">
                    <div class="box">
                        <div class="box-head tabs">
                            <h3>Célula perfiles</h3>
                            <ul class="nav nav-tabs">
                                <li class='active'>
                                    <a href="#basic" data-toggle='tab'>Información Básica</a>
                                </li>
                                <li>
                                    <a href="#sec" data-toggle='tab'>Ubicación</a>
                                </li>
                               
                            </ul>
                        </div>
                        <div class="box-content">
                            <form action="#" class="form-horizontal" id="form_celula" name="form_celula" method="POST">
                            <div class="tab-content">
                                <div class="tab-pane active" id="basic">
                                    
                                        <div class="control-group">
                                            <label for="red_lista" class="control-label">Red</label>
                                            <div class="controls">
                                                <select id="red_lista" name="red_lista">
                                                    
                                                </select>
                                            </div>
                                        </div>
                                    
                                        <div class="control-group">
                                            <label class="control-label" >Tipo </label>
                                                <div class="controls">
                                                    <select id="tipo" name="tipo" required >
                                                        <option value="0">Evangelismo</option>
                                                        <option value="1">Discipulado</option>                                                       
                                                    </select>
                                                </div>
                                        </div>
                                    
                                       <div class="control-group">
                                            <label class="control-label">Fecha Creación(*)</label>
                                            <div class="controls">
                                                <input type= "text" class="datepick input-medium" id="creacion"
                                                    name="creacion" required/>
                                                <p class="help-block">Día/Mes/Año</p>  
                                            </div>
                                        </div>
                                    
                                         <div class="control-group">
                                            <label class="control-label">Dia Visita(*)</label>
                                            <div class="controls">
                                                <select id="dia" name="dia" class="input-medium" required >
                                                    <option value="Lunes">Lunes</option>
                                                    <option value="Martes">Martes</option>
                                                    <option value="Miercoles">Miercoles</option>
                                                    <option value="Jueves">Jueves </option>
                                                    <option value="Viernes">Viernes </option>
                                                    <option value="Sabado">Sabado</option>
                                                    <option value="Domingo">Domingo</option>
                                                </select>
                                            </div>
                                        </div>
                                    
                                        <div class="control-group" >
                                            <label class="control-label">Hora(*)</label>
                                            <div class="controls">
                                                <input type="time" id="hora" name="hora" value="00:00:00" class="input-small"required >                       
                                            </div>
                                        </div>
                                        
                                        <div class="control-group" id="lider_div" style="display:none;">
                                            <label for="lider" class="control-label">Lider</label>
                                            <input type="hidden" id="lider_id_past" name="lider_id_past" value="-1">
                                            <div class="controls">
                                                <div class="input-append">
                                                    <input type="hidden" name="lider_id" id="lider_id">
                                                    <input type="text" name="lider" id="lider" required>
                                                </div>
                                            </div>
                                        </div>                                      
                                </div>
                                <div class="tab-pane" id="sec">
                                    
                                    <div class="control-group">
                                        <label class="control-label" >Familia</label>
                                        <div class="controls">
                                            <input type="text" class="input-xxlarge" id="familia" name="familia" >
                                        </div>
                                    </div>
                                    
                                    <div class="control-group">
                                        <label class="control-label">Telefono</label>
                                        <div class="controls">
                                            <input type="tel" class="input-xxlarge" id="telefono" name="telefono" required>
                                        </div>
                                        
                                    </div>
                                    <div class="control-group">
                                        <label class="control-label">Dirección (*)</label>
                                        <div class="controls">
                                            <input type="text" class="input-xxlarge" id="inputDireccion" name="inputDireccion" required />
                                        </div>
                                    </div>
        
                                    <div class="control-group">
                                        <label class="control-label">Referencia</label>
                                        <div class="controls" >
                                            <input type="text" class="input-xxlarge" id="inputReferencia" name="inputReferencia" />
                                        </div>
                                    </div>
                
                                    <div class="">
                                        <div class="">
                                            <div class="control-group">
                                                <label class="control-label" >Departamento (*)</label>
                                                <div class="controls">
                                                    <select name="departamento_lista" id="departamento_lista" required  class="input-medium">
                    
                                                    </select>
                                                </div>
                                            </div>  
                                        </div>
        
                                    <div class="">
                                        <div class="control-group">
                                            <label class="control-label" >Provincia (*)</label>
                                            <div class="controls">
                                                <select name="provincia_lista" id="provincia_lista" required class="input-medium">
                   
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                    
                                    <div class="">
        
                                        <div class="control-group">
                                            <label class="control-label">Distrito (*)</label>
                                            <div class="controls">
                                                <select name="distrito_lista" id="distrito_lista" required class="input-medium">
                    
                                                </select>
                                            </div>        
                                        </div>
                                </div>
                            </div>
                          </div>
                                
                            </div>
                                <div class="form-actions">
                                    <input type="submit" class='btn btn-primary' value="Guardar" id="btnGuardarCelula" name="btnGuardarCelula">
                                    <input type="reset" class='btn btn-danger' value="Cancelar">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            
            <div class="row-fluid">
                <div class="span12">
                    <div class="box">
                        
                        <div class="box-head">
                            <h3>Células registradas recientemente</h3>
                        </div>
                        <div class="box-content box-nomargin">
                            
                            <table cellpadding="0" cellspacing="0" border="0" class="data-table table table-condensed table-striped table-hover table-bordered pull-left"  id="tabla_celulas" name="tabla_celulas">
                                    <thead id='lol'>
                                        <tr>
                                            <th width="25%">Lider</th>
                                            <th witdh="6%">Creado</th>                                        
                                            <th width="5%">Red</th>
                                            <th>Direccion</th>
                                            <th>Telefono</th>
                                            <th>Día</th>
                                            <th width="5%">Hora</th>
                                            <th>Estado</th>
                                            <th>Tipo</th>
                                        </tr>
                                    </thead>
                            </table>
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>  
    </div>
        
{% endblock %}
      
               
      {%block javascript %}
            <script type="text/javascript" src="{{asset('js/jquery.js')}}"></script>
            <script type="text/javascript" src="{{asset('js/bootstrap-typeahead.js')}}"></script>
            <script type="text/javascript" src="{{asset('js/bootstrap-collapse.js')}}"></script>
            <script type="text/javascript" src="{{asset('js/bootstrap-button.js')}}"></script>
            <script type="text/javascript" src="{{asset('js/bootstrap-tooltip.js')}}"></script>
            <script type="text/javascript" src="{{asset('js/bootstrap-tab.js')}}"></script>
            <script type="text/javascript" src="{{asset('js/bootstrap.js')}}"></script>    
            <script src="{{asset('js/custom.js')}}"></script>              
            <!--[if lt IE 9]> <script type="text/javascript" src="{{asset('js/html5.js')}}"></script><![endif]-->
            <script src="{{asset('js/util/functiongen.js')}}"> </script>
            <script src="{{asset('js/jquery/jquery.ui.core.min.js')}}"></script>
            <script src="{{asset('js/jquery/jquery.ui.widget.min.js')}}"></script>
            <script src="{{asset('js/jquery/jquery.ui.position.min.js')}}"></script>
            <script src="{{asset('js/jquery/jquery.ui.autocomplete.min.js')}}"></script>
            <script src="{{asset('js/bootstrap.datepicker.js')}}"></script>
            <script src="{{asset('js/util/functiongen.js')}}"> </script>
            <script src="{{asset('js/enviar.js')}}"></script>
            
            <script src="{{asset('js/jquery.sparkline.js')}}"> </script>
            <script src="{{asset('js/jquery.dataTables.js')}}"> </script>
            <script src="{{asset('js/jquery.dataTables.bootstrap.js')}}"></script>
            <script src="{{asset('js/custom-tables.js')}}"> </script>
            
            <script src="{{asset('js/util/datatable_plugins.js')}}"></script>
            <script src="{{asset('js/otherfunctiondatatable.js')}}"></script>

      
      <script type="text/javascript">
          
                $redes = null;
                root = typeof exports !== "undefined" && exports !== null ? exports : this;

                root.SourceTServicio = "/recuperar_personas_inicio";
                
                var CelulasTable;

                root.DatosEnviar = null;
                personas = null;
                
                urlES = "{{asset('js/dt_ES.txt')}}";

        
                PrepararDatos = function() {
                    return root.DatosEnviar = {
                            "formulario": $("#form_celula").serializeObject()
                    };
                };

                SuccessFunction = function(data) {
                   
                    if(data.responseCode===200 ){          
                      
                       $("#form_celula").reset();
                      
                        alert('Registro Completado');
                                                
                        $("#lider").val("");
                        $("#lider_id").val(-1);     
                        $("#lider_id_past").val(-1); 
                       
                        CelulasTable.fnReloadAjax('{{path('services_ultimas_celula_table')}}');

                    }
                    else if(data.responseCode===400){//bad request
                        alert('Error bad request');
                        }
                    else{                        
                        if(data.responseCode===500)
                        {
                            alert('Error bad request');
                        }
                        else alert("An unexpeded error occured.");
                        }
                    
                };

    
        lider_cambio_red = function()
        {
            red = $("#red_lista").val();
            
            if(red != '-1')
            {
                url = '{{path( 'service_lider_celula_all',{'red':'nom'})}}';
                url = url.replace('nom',red);
                                
                personas = getAjaxObject(url);                     
                $("#lider").autocomplete({
                    source: personas,
                    select: function(event, ui) {
                            $("#lider_id").val(ui.item.id);
                            $("#lider").val(ui.item.label);
                            return false;
                    }
                });
                 
                 if(personas.length > 0)
                 {
                    $("#lider_div").css("display","block");
                }
                else
                {
                    $("#lider_div").css("display","none");
                }
                 $("#lider").val("");
                 $("#lider_id").val(-1);     
                 $("#lider_id_past").val(-1);
            }
            else
            {
                 $("#lider_div").css("display","block");
            }
           
        };
        
	$(document).ready(function() {
            
            ubigeos = getAjaxObject("{{asset('js/ubi.json')}}");
            cargarUbigeo(ubigeos, "distrito_lista", "provincia_lista", "departamento_lista");
                 
            redes = getAjaxObject('{{path('services_red')}}');
                          
            cargarSelect(redes, "red_lista", "int_red_id", "id");
            
            CelulasTable = createDataTable("tabla_celulas", '{{path('services_ultimas_celula_table')}}', FormatoTable, null, null);

                     
            $("#form_celula").submit(function(event){
                
                 event.preventDefault();
                 PrepararDatos();
                 return enviar('{{path('celula_save')}}', root.DatosEnviar, SuccessFunction, null);
  
            });
            
            $("#red_lista").change(lider_cambio_red);
        
        } );

       </script>
      {%endblock %}