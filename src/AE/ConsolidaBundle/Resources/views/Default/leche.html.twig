{% extends "::base.html.twig" %}
   {% block stylesheets %}
        <link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.css" media="screen" rel="stylesheet" type="text/css">
        <link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap-responsive.css" media="screen" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.datepicker.css">
        <link href="{{asset('css/style.css')}}" media="screen" rel="stylesheet" type="text/css">
        <!-- Scripts -->                 
   {% endblock %}
        
{% block content %}

       <div class="container-fluid">
        <div class="content">
          
            <div class="row-fluid">
                <div class="span12">
                    <div class="box">
                        <div class="box-head tabs">
                            <h3>Crear Leche Espiritual</h3>
                            <ul class="nav nav-tabs">
                                <li class='active'>
                                    <a href="#basic" data-toggle='tab'>Información Básica</a>
                                </li>  
                            </ul>
                        </div>
                        
                        <div class="box-content">
                            <form action="#" class="form-horizontal" id="form_leche" name="form_leche" method="POST">
                            <div class="tab-content">
                                <div class="tab-pane active" id="basic">
                                    
                                        <div class="control-group">
                                            <label class="control-label">Nombre</label>
                                            <div class="controls">
                                                <input type="text" id="nombre" name="nombre" required class='input-xlarge'>
                                            </div>
                                        </div>
                                    
                                        <div class="control-group">                                            
                                            <label class="control-label">Fecha Creación</label>
                                            <div class="controls">
                                               <input type= "text" class="datepick input-xlarge" id="fecha"
                                                    name="fecha" required/>
                                                <p class="help-block">Día/Mes/Año</p>  
                                            </div>                                          
                                        </div>
                                    
                                        <div class="control-group">
                                            <label class="control-label">Resumén</label>
                                            <div class="controls">
                                                <textarea id="resumen" name="resumen" class="input-xlarge">
                                                    
                                                </textarea>
                                            </div>
                                        </div>
                                    
                                        
                                    
                                        <div class="control-group" >                                            
                                            <label class="control-label">Clase</label>
                                            <div class="controls">
                                                <input type="text" id="clase" name="clase" class="input-xlarge">
                                                <input type="button" id="btnAddClase" name="btnAddClase"  class="btn btn-success" value="Añadir">
                                            </div>                                          
                                        </div>                                 
                                </div>
                              
                            </div>
                                <div class="form-actions">
                                    <input type="submit" class='btn btn-primary' value="Guardar" id="btnGuardarServicio" name="btnGuardarServicio">
                                    <input type="reset" class='btn btn-danger' value="Cancelar">
                                </div>
                            </form>
                            
                             <div >
                                <table class='table table-condensed table-striped table-hover table-bordered pull-left' id='table_leccion' name="table_leccion">
                                    <thead>
                                        <tr>
                                            <th style='width:33%'>N°</th>
                                            <th style='width:33%'>Lección</th>
                                            
                                            <th class='hidden-phone' style='width:33%'>Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            
                            
                        </div>
                    </div>
                
                    <div  class="box">
                        <div class="box-head">
                            <h3>Clases de Leche Espiritual</h3>
                        </div>
                        <div class="box-content box-nomargin">
                            <table id="tabla_leche" name="tabla_leche" class='table table-striped table-bordered'>
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
					<th>Creación</th>
					<th>Resumén</th>
                                        <th>Estado</th>
					<th>Clases</th>
					<th>Acciones</th>
                                    </tr>
				</thead>
				<tbody>
												
						
				</tbody>
                           </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>  
    </div>
        
{% endblock %}
      
               
      {%block javascript %}
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/jquery.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-typeahead.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-collapse.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-button.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-tooltip.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-tab.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.js"></script>    
            <script src="http://d19k46zntalu3t.cloudfront.net/js/custom.js"></script>              
            <!--[if lt IE 9]> <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/html5.js"></script><![endif]-->
            <script src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.datepicker.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/bbq.js"> </script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/chosen.jquery.min.js"> </script>
            <script src="https://www.google.com/jsapi"></script>
            <!--[if lt IE 9]> <script type="text/javascript" src="/net/public/js/html5.js"></script><![endif]-->              
            
        
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.sparkline.js"> </script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery.dataTables.js"> </script>
            <script src="{{asset('js/jquery.dataTables.bootstrap.js')}}"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/custom-tables.js"> </script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/util/datatable_plugins.js"></script>
            <script src="{{asset('js/util/functiongen.js')}}"> </script>
            
            

      
      <script type="text/javascript">
          
                $redes = null;
                root = typeof exports !== "undefined" && exports !== null ? exports : this;
                var leccionTabla;
                var temas_leche = null;

                root.SourceTServicio = "{{path('services_temas_leche_tabla')}}";

                root.DatosEnviar = null;
                root.count = 0;
                personas = null;
                
                urlES = "https://s3.amazonaws.com/acfinal/dt_ES.txt";
                
                
                columnas_lecciones = [
                {
                    "mDataProp": "nombre"
                }, {
                    "mDataProp": "creacion"
                }, {
                    "mDataProp": "resumen"
                },
                {
                    "mDataProp": "activo"
                },
                {
                    "mDataProp": "lecciones"
                },
                {
                    "mDataProp": "acciones"
                }
                ];
        
                PrepararDatos = function() {
                    return root.DatosEnviar = {
                            "formulario": $("#form_leche").serializeObject(),
                            "tabla" : leccionTabla.fnGetData()
                    };
                };

                SuccessFunction = function(data) {
                                        
                    if(data.responseCode===200 ){          
                      
                       $("#form_leche").reset();                      
                        alert('Registro Completado');
                        leccionTabla.fnClearTable();
                        temas_leche.fnReloadAjax(root.SourceTServicio);
                        
                    }
                    else if(data.responseCode===400){//bad request
                       alert('Error bad request');
                        }
                    else{                        
                        if(data.responseCode===500)
                        {
                            alert('Error bad request');
                        }
                        else alert("An unexpeded error occured.");
                        }
                    
                };
                
            
        rowcb = function(nRow, aData, iDisplayIndex) {
          
          var index;
          index = $(temas_leche.fnGetData()).getIndexObj(aData, 'id');
          acciones = getActionButtons("001");
                
          temas_leche.fnUpdate(acciones, index, 5);
          
          return $(nRow).find('.delete-row').click(function(e) {
                
                //return temas_leche.fnDeleteRow(index);
               {% if is_granted('ROLE_CONSOLIDAR') %}                 

                enviar('{{path('leche_delete')}}', {'id': aData.id}, SuccessFunction, null);
                

                {% endif %}
             });
            };
	$(document).ready(function() {
            

         temas_leche = createDataTable("tabla_leche",root.SourceTServicio,columnas_lecciones,null,rowcb);
        
        leccionTabla = $('#table_leccion').dataTable({
            "aoColumns": [
            {
                "mDataProp": "numero"
            }, {
                "mDataProp": "leccion"
            }, {
                "mDataProp": "btn_elim"
            }
            ],
            "bPaginate": false,
            "sDom": "<r>t<'row-fluid'>",
            "fnCreatedRow": function(nRow, aData, iDisplayIndex) {

       
            return $(nRow).find('.delete-row').click(function(e) {
                var index;
                index = $(leccionTabla.fnGetData()).getIndexObj(aData, 'numero');
                return leccionTabla.fnDeleteRow(index);
                root.count = root.count -1;
                console.log(root.count);
             });
            }
            });
            
            
            
        $('#btnAddClase').click(function(event) {
            var num, leccion;
            event.preventDefault();
          
            if ($("#clase").val().length > 0) {
                leccion = {
                    "numero": root.count,
                    "leccion": $("#clase").val(),
                    "btn_elim": getActionButtons("001")
                };
                leccionTabla.fnAddData(leccion);
                root.count++;
                $("#clase").val("");
                return false;
            }
        });

            $("#form_leche").submit(function(event){                
                 event.preventDefault();
                 PrepararDatos();
                 return enviar('{{path('leche_save')}}', root.DatosEnviar, SuccessFunction, null);  
            });
       
            
        } );

       </script>
      {%endblock %}