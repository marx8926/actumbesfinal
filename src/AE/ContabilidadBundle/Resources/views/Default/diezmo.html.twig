{% extends "::base.html.twig" %}
        {% block stylesheets %}
        <link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.css" media="screen" rel="stylesheet" type="text/css">
        <link href="http://d19k46zntalu3t.cloudfront.net/css/style.css" media="screen" rel="stylesheet" type="text/css">
        <link href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap-responsive.css" media="screen" rel="stylesheet" type="text/css">
       <link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/bootstrap.datepicker.css">

        <link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/smooth/jquery-ui-1.8.16.custom.css" >
        <link rel="stylesheet" href="http://d19k46zntalu3t.cloudfront.net/css/chosen.css">
        <!-- Scripts -->
                 
        {% endblock %}
        
{% block content %}

       <div class="container-fluid">
        <div class="content">
          
            <div class="row-fluid">
                <div class="span12">
                    <div class="box">
                        <div class="box-head tabs">
                            <h3>Diezmo</h3>
                            <ul class="nav nav-tabs">
                                <li class='active'>
                                    <a href="#basic" data-toggle='tab'>Información</a>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="box-content">
                            <form action="#" class="form-horizontal" id="form_diezmo" name="form_diezmo" method="POST">
                            <div class="tab-content">
                                <div class="tab-pane active" id="basic">
                                    
                                        <div class="control-group">
                                            <label class="control-label">Red</label>
                                            <div class="controls">
                                                <select id="red_lista" name="red_lista" required>
                                                    
                                                </select>
                                            </div>
                                        </div>
                                    
                                        <div class="control-group">
                                            <label class="control-label">Persona</label>
                                            <div class="controls">
                                                <input type="hidden" name="persona_id" id="persona_id" value="-1">
                                                <input type="text" name="persona" id="persona">
                                            </div>
                                        </div>
                                    
                                        <div class="control-group">                                            
                                            <label class="control-label">Fecha</label>
                                            <div class="controls">
                                               <input type= "text" class="datepick input-medium" id="fecha"
                                                    name="fecha" required/>
                                                <p class="help-block">Día/Mes/Año</p>  
                                            </div>                                          
                                        </div>
                                    
                                        <div class="control-group" >                                            
                                            <label class="control-label">Monto</label>
                                            <div class="controls">
                                                <input type="text" id="monto" name="monto">
                                            </div>                                          
                                        </div>
                                    
                                        <div class="control-group">
                                            <label class="control-label">Petición</label>
                                            <div class="controls">
                                              <textarea rows="5" id="peticion" name="peticion" class="input-xlarge" required> </textarea>
 
                                            </div>
                                        </div>
                                    
                                                                                           
                                </div>
                              
                            </div>
                                <div class="form-actions">
                                    <input type="submit" class='btn btn-primary' value="Guardar" id="btnGuardarServicio" name="btnGuardarServicio">
                                    <input type="reset" class='btn btn-danger' value="Cancelar">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>  
    </div>
        
{% endblock %}
      
               
      {%block javascript %}
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/jquery.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-typeahead.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-collapse.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-button.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-tooltip.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap-tab.js"></script>
            <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.js"></script>    
            <script src="http://d19k46zntalu3t.cloudfront.net/js/custom.js"></script>              
            <!--[if lt IE 9]> <script type="text/javascript" src="http://d19k46zntalu3t.cloudfront.net/js/html5.js"></script><![endif]-->
            <script src="http://d19k46zntalu3t.cloudfront.net/js/util/functiongen.js"> </script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.core.min.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.widget.min.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.position.min.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/jquery/jquery.ui.autocomplete.min.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/bootstrap.datepicker.js"></script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/util/functiongen.js"> </script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/bbq.js"> </script>
            <script src="http://d19k46zntalu3t.cloudfront.net/js/chosen.jquery.min.js"> </script>

      
      <script type="text/javascript">
          
                $redes = null;
                root = typeof exports !== "undefined" && exports !== null ? exports : this;

                root.SourceTServicio = "/recuperar_personas_inicio";

                root.DatosEnviar = null;
                personas = null;
        
                PrepararDatos = function() {
                    return root.DatosEnviar = {
                            "formulario": $("#form_diezmo").serializeObject()
                    };
                };

                SuccessFunction = function(data) {
                    
                    console.log(data);
                    
                    if(data.responseCode===200 ){          
                      
                       $("#form_diezmo").reset();                      
                        alert('Registro Completado');
                        
                    }
                    else if(data.responseCode===400){//bad request
                       alert('Error bad request');
                        }
                    else{                        
                        if(data.responseCode===500)
                        {
                            alert('Error bad request');
                        }
                        else alert("An unexpeded error occured.");
                        }
                    
                };
                
            
             persona_autocomplete_red = function()
             {
                 
                 if($("#red_lista").val() == '-1')
                 {
                    // personas = getAjaxObject('{{path('services_ganadores_autocomplete_all')}}');
                 }
                 else
                 {
                     //recargar celula
                     //recargar ganador
                     //nuevo convertido
                     
                     url = '{{path( 'services_ganadores_autocomplete_red', {'red':'cod'} )}}';
                     url = url.replace('cod',$("#red_lista").val());
             
                     personas = getAjaxObject(url);
                     
                     $("#persona").autocomplete({
                        source: personas,
                        select: function(event, ui) {
                            $("#persona_id").val(ui.item.id);
                            $("#persona").val(ui.item.label);
                            return false;
                        }
                    });
                    
                    $("#persona_id").val(-1);
                 }
                 
             };
      
	$(document).ready(function() {
                    
            redes = getAjaxObject('{{path('services_red')}}');
                          
            cargarSelect(redes, "red_lista", "int_red_id", "id");
            
            servicio = getAjaxObject('{{path('service_get_servicios_all')}}');
                          
            cargarSelect(servicio, "servicio", "id","horario");
            
            $("#form_diezmo").submit(function(event){
                
                 event.preventDefault();
                 PrepararDatos();
                 console.log(root.DatosEnviar);
                 return enviar('{{path('diezmo_save')}}', root.DatosEnviar, SuccessFunction, null);
  
            });
       
            persona_autocomplete_red();
            $("#red_lista").change(persona_autocomplete_red);
            
        } );

       </script>
      {%endblock %}